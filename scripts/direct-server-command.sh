#!/bin/bash

echo "ğŸ¯ ê¹€ì‹œì˜¨ í•™ìƒ 10ë ˆë²¨ ì¹´ë“œ ì„œë²„ ì§ì ‘ ìƒì„± ëª…ë ¹ì–´"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""

echo "ğŸ“‹ í”„ë¡œë•ì…˜ ì„œë²„(43.200.27.173)ì—ì„œ ì‹¤í–‰í•  ëª…ë ¹ì–´:"
echo ""
echo "cd /home/ubuntu/vacation"
echo ""
echo "# ë°©ë²• 1: Node.js ìŠ¤í¬ë¦½íŠ¸ë¡œ ì§ì ‘ ìƒì„±"
echo "DATABASE_URL=\"postgresql://postgres:postgres@localhost:5432/studylog_db\" node -e \""
echo "const { PrismaClient } = require('@prisma/client');"
echo "const prisma = new PrismaClient();"
echo ""
echo "(async () => {"
echo "  try {"
echo "    // ê¹€ì‹œì˜¨ í•™ìƒ ì°¾ê¸°"
echo "    const user = await prisma.user.findUnique({"
echo "      where: { email: 'kimsion70823@gmail.com' },"
echo "      include: { studentProfile: { include: { levelImages: true } } }"
echo "    });"
echo ""
echo "    if (!user?.studentProfile) {"
echo "      console.log('âŒ ê¹€ì‹œì˜¨ í•™ìƒì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');"
echo "      return;"
echo "    }"
echo ""
echo "    console.log(\`âœ… ê¹€ì‹œì˜¨ í•™ìƒ ë°œê²¬: \${user.name} (ë ˆë²¨ \${user.studentProfile.level})\`);"
echo ""
echo "    // ê¸°ì¡´ 10ë ˆë²¨ ì¹´ë“œ ì‚­ì œ"
echo "    const existing = await prisma.levelImage.findFirst({"
echo "      where: { studentId: user.studentProfile.id, level: 10 }"
echo "    });"
echo ""
echo "    if (existing) {"
echo "      await prisma.levelImage.delete({ where: { id: existing.id } });"
echo "      console.log('ğŸ—‘ï¸ ê¸°ì¡´ 10ë ˆë²¨ ì¹´ë“œ ì‚­ì œ ì™„ë£Œ');"
echo "    }"
echo ""
echo "    // ìƒˆ 10ë ˆë²¨ ì¹´ë“œ ìƒì„±"
echo "    const newCard = await prisma.levelImage.create({"
echo "      data: {"
echo "        studentId: user.studentProfile.id,"
echo "        level: 10,"
echo "        imageUrl: '/level-cards/kim-sion-level-10-1757486919979.svg',"
echo "        prompt: 'Apple Scholar Level 10 - Korean webtoon style character card',"
echo "        strength: user.studentProfile.strength,"
echo "        intelligence: user.studentProfile.intelligence,"
echo "        dexterity: user.studentProfile.dexterity,"
echo "        charisma: user.studentProfile.charisma,"
echo "        vitality: user.studentProfile.vitality,"
echo "        totalXP: user.studentProfile.totalXP,"
echo "        totalMinutes: user.studentProfile.totalMinutes"
echo "      }"
echo "    });"
echo ""
echo "    console.log('ğŸ‰ ê¹€ì‹œì˜¨ 10ë ˆë²¨ ì¹´ë“œ ìƒì„± ì™„ë£Œ!');"
echo "    console.log(\`ğŸ“‹ ì¹´ë“œ ID: \${newCard.id}\`);"
echo "    console.log('ğŸ’¡ ê°¤ëŸ¬ë¦¬ì—ì„œ í™•ì¸ ê°€ëŠ¥í•©ë‹ˆë‹¤!');"
echo ""
echo "  } catch (error) {"
echo "    console.error('ğŸ’¥ ì˜¤ë¥˜:', error);"
echo "  } finally {"
echo "    await prisma.\\\$disconnect();"
echo "  }"
echo "})();"
echo "\""
echo ""
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""
echo "ğŸ¯ ë˜ëŠ” ë” ê°„ë‹¨í•˜ê²Œ:"
echo ""
echo "# ë°©ë²• 2: SQL ì§ì ‘ ì‹¤í–‰"
echo "docker exec -it studylog_postgres psql -U postgres -d studylog_db -c \""
echo "INSERT INTO \\\"LevelImage\\\" ("
echo "  id, \\\"studentId\\\", level, \\\"imageUrl\\\", prompt,"
echo "  strength, intelligence, dexterity, charisma, vitality,"
echo "  \\\"totalXP\\\", \\\"totalMinutes\\\", \\\"createdAt\\\", \\\"updatedAt\\\""
echo ") SELECT "
echo "  'kim-sion-level-10-' || EXTRACT(EPOCH FROM NOW())::text,"
echo "  sp.id, 10, '/level-cards/kim-sion-level-10-1757486919979.svg',"
echo "  'Apple Scholar Level 10 Card',"
echo "  sp.strength, sp.intelligence, sp.dexterity, sp.charisma, sp.vitality,"
echo "  sp.\\\"totalXP\\\", sp.\\\"totalMinutes\\\", NOW(), NOW()"
echo "FROM \\\"StudentProfile\\\" sp"
echo "JOIN \\\"User\\\" u ON sp.\\\"userId\\\" = u.id"
echo "WHERE u.email = 'kimsion70823@gmail.com'"
echo "ON CONFLICT DO NOTHING;"
echo "\""
echo ""
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""
echo "âœ… ì‹¤í–‰ í›„ í™•ì¸:"
echo "- ê¹€ì‹œì˜¨ í•™ìƒì´ ê°¤ëŸ¬ë¦¬(/dashboard/gallery)ì—ì„œ 10ë ˆë²¨ ì¹´ë“œ í™•ì¸"
echo "- í”„ë¡œí•„ í˜ì´ì§€ì—ì„œë„ ì¹´ë“œ í‘œì‹œë¨"
echo ""
echo "ğŸ¨ ìƒì„±ë˜ëŠ” ì¹´ë“œ:"
echo "- Apple Scholar ìºë¦­í„°"
echo "- ê¹€ì‹œì˜¨ í•™ìƒì˜ ì‹¤ì œ ëŠ¥ë ¥ì¹˜ ë°˜ì˜"
echo "- í•œêµ­ ì›¹íˆ° ìŠ¤íƒ€ì¼, ë¸Œë¡ ì¦ˆ í…Œë§ˆ"